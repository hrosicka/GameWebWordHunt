<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Word Detective</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>
    <h1>Word Detective</h1>
    <div id="score-container">
        <h2>Current Score <span id="score">0</span></h2>
    </div>
    <div class="clues-container">
        <p>{{ clues }}</p>
    </div>
    <div class="secret-word-container">
        {% for letter in guessed_letters %}
            <span class="letter">{{ letter }}</span>
        {% endfor %}
    </div>
    <p class="attempts-left">Attempts Left: {{ attempts_left }}</p>
    <p class="message">{{ message }}</p>

    {% if attempts_left > 0 and "_" in guessed_letters %}
    <form method="POST" action="/">
        <label for="guess">Your Guess</label>
        <input type="text" id="guess" name="guess" autocomplete="off" placeholder="Enter a letter">
        <button type="submit">Guess</button>
    </form>
    {% endif %}

    <p><a class="new-game-link" href="{{ url_for('new') }}">Start New Game</a></p>

    <div class="link-container">
        <a class="new-game-link" href="{{ url_for('add_word') }}">Add New Word</a>
        <a class="new-game-link" href="{{ url_for('preview') }}">Preview Data</a>
    </div>

</body>
</html>

<script>
    // Funkce pro kontrolu, zda hráč správně uhodl slovo
    document.addEventListener('DOMContentLoaded', function () {
        const guessedLetters = "{{ guessed_letters|join('') }}"; 
        if (!guessedLetters.includes('_')) { // 
            updateScore(10); 
        }
    });

    // Načtení skóre při načtení stránky
    function loadScore() {
        fetch('/scores')
            .then(response => response.json())
            .then(data => {
                const player = 'Guest'; // Změňte na aktuální hráče
                const score = data.player_scores[player] || 0;
                document.getElementById('score').innerText = score;
            });
    }

    // Odeslání bodů po správné odpovědi
    function updateScore(points) {
        fetch('/update_score', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                player: 'Guest', // Změňte na aktuální hráče
                points: points
            })
        }).then(() => loadScore());
    }

    // Načtení skóre při načtení stránky
    document.addEventListener('DOMContentLoaded', loadScore);
</script>